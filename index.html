<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Giveaway Verification</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">

    <div class="bg-white p-8 rounded-lg shadow-md w-full max-w-md">

        <div id="login-state">
            <h2 class="text-2xl font-bold text-center mb-6">Verify Your Entry</h2>
            <p class="text-center text-gray-600 mb-6">Please sign in with the Google account you used to comment on YouTube to claim your prize.</p>
            <button id="login-button" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg flex items-center justify-center">
                <svg class="w-5 h-5 mr-3" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="48px" height="48px"><path fill="#fbc02d" d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12 s5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24s8.955,20,20,20 s20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"></path><path fill="#e53935" d="M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039 l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"></path><path fill="#4caf50" d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36 c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z"></path><path fill="#1565c0" d="M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571 c0.001-0.001,0.002-0.001,0.003-0.002l6.19,5.238C36.971,39.205,44,34,44,24C44,22.659,43.862,21.35,43.611,20.083z"></path></svg>
                Sign In with Google
            </button>
            <p id="error-message" class="text-red-500 text-center mt-4" style="display: none;">An error occurred. Please try again.</p>
        </div>

        <div id="loading-state" style="display: none;" class="text-center">
            <svg class="animate-spin h-8 w-8 text-blue-600 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <p class="mt-4 text-lg font-semibold text-gray-700">Verifying your account...</p>
        </div>

        <div id="form-state" style="display: none;">
            <h2 class="text-2xl font-bold text-center mb-2">Verification Complete!</h2>
            <p class="text-center text-green-600 font-semibold mb-6">
                Verified as: <span id="channel-name" class="text-blue-700"></span>
            </p>
            <p class="text-center text-gray-600 mb-6">Please provide your shipping details to claim your prize.</p>
            
            <form id="details-form">
                <div class="mb-4">
                    <label for="full-name" class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                    <input type="text" id="full-name" name="full-name" autocomplete="name" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div class="mb-4">
                    <label for="address-line1" class="block text-sm font-medium text-gray-700 mb-1">Address Line 1</label>
                    <input type="text" id="address-line1" name="address-line1" autocomplete="address-line1" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div class="mb-4">
                    <label for="city" class="block text-sm font-medium text-gray-700 mb-1">City</label>
                    <input type="text" id="city" name="city" autocomplete="address-city" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div>
                        <label for="state" class="block text-sm font-medium text-gray-700 mb-1">State / Province</label>
                        <input type="text" id="state" name="state" autocomplete="address-level1" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label for="zip" class="block text-sm font-medium text-gray-700 mb-1">ZIP / Postal Code</label>
                        <input type="text" id="zip" name="zip" autocomplete="postal-code" required class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                    </div>
                </div>
                <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg">
                    Submit Details
                </button>
            </form>
        </div>

        <div id="success-state" style="display: none;" class="text-center">
            <h2 class="text-2xl font-bold text-green-600 mb-4">Thank You!</h2>
            <p class="text-gray-700 text-lg">Your information has been successfully received. We'll be in touch soon!</p>
        </div>

    </div>

    <script>
        // --- CONFIGURATION ---
        const CLIENT_ID = '753346673939-e63gqpcmgvruea5a3da783q66hmcv59e.apps.googleusercontent.com'; // â— PASTE YOUR CLIENT ID HERE
        const YOUTUBE_SCOPE = 'https://www.googleapis.com/auth/youtube.readonly';
        // --- END CONFIGURATION ---

        // State Management
        const loginState = document.getElementById('login-state');
        const loadingState = document.getElementById('loading-state');
        const formState = document.getElementById('form-state');
        const successState = document.getElementById('success-state');
        const errorMessage = document.getElementById('error-message');

        function showState(state) {
            loginState.style.display = 'none';
            loadingState.style.display = 'none';
            formState.style.display = 'none';
            successState.style.display = 'none';
            
            if (state === 'login') loginState.style.display = 'block';
            if (state === 'loading') loadingState.style.display = 'block';
            if (state === 'form') formState.style.display = 'block';
            if (state === 'success') successState.style.display = 'block';
        }

        // GSI Token Client
        let tokenClient;

        function initClient() {
            tokenClient = google.accounts.oauth2.initTokenClient({
                client_id: CLIENT_ID,
                scope: YOUTUBE_SCOPE,
                callback: (tokenResponse) => {
                    if (tokenResponse && tokenResponse.access_token) {
                        verifyUser(tokenResponse.access_token);
                    } else {
                        console.error("No access token found in response:", tokenResponse);
                        showState('login');
                        errorMessage.style.display = 'block';
                    }
                },
                error_callback: (error) => {
                    console.error("OAuth Error:", error);
                    showState('login');
                    errorMessage.style.display = 'block';
                }
            });
        }
        
        // Wait for GSI to load to initialize the client
        window.onload = () => {
            // GSI loads `google` object. We check until it's ready.
            const checkGoogle = setInterval(() => {
                if (window.google && window.google.accounts) {
                    clearInterval(checkGoogle);
                    initClient();
                }
            }, 100);
        };

        // --- Step 1: Handle Login Button Click ---
        document.getElementById('login-button').addEventListener('click', () => {
            errorMessage.style.display = 'none';
            if (tokenClient) {
                tokenClient.requestAccessToken();
            } else {
                console.error("Token client not initialized.");
                errorMessage.style.display = 'block';
            }
        });

        // --- Step 2: Verify User with YouTube API ---
        async function verifyUser(accessToken) {
            showState('loading');
            try {
                const response = await fetch('https://www.googleapis.com/youtube/v3/channels?part=snippet&mine=true', {
                    headers: {
                        'Authorization': `Bearer ${accessToken}`
                    }
                });

                if (!response.ok) {
                    throw new Error(`API Error: ${response.status} ${response.statusText}`);
                }

                const data = await response.json();
                
                if (data.items && data.items.length > 0) {
                    const channelName = data.items[0].snippet.title;
                    document.getElementById('channel-name').textContent = channelName;
                    showState('form');
                } else {
                    throw new Error("No channels found for this user.");
                }
            } catch (error) {
                console.error("Failed to verify user:", error);
                showState('login');
                errorMessage.style.display = 'block';
            }
        }

        // --- Step 3: Handle Form Submission (Mock) ---
        document.getElementById('details-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            showState('loading'); // Show loading spinner during mock submission

            const formData = {
                fullName: document.getElementById('full-name').value,
                addressLine1: document.getElementById('address-line1').value,
                city: document.getElementById('city').value,
                state: document.getElementById('state').value,
                zip: document.getElementById('zip').value,
                verifiedChannel: document.getElementById('channel-name').textContent
            };

            try {
                await submitToApi(formData);
                showState('success');
            } catch (error) {
                console.error("Submission error:", error);
                showState('form'); // Go back to form on error
                // In a real app, you'd show an error message on the form.
            }
        });

        // --- Mock API Submission Function ---
        function submitToApi(formData) {
            console.log("Submitting to mock API:", formData);
            
            // Simulate a 1-second network delay
            return new Promise((resolve, reject) => {
                setTimeout(() => {
                    // You can test a failure case by uncommenting the line below:
                    // reject(new Error("Mock API failure"));
                    
                    console.log("Mock submission successful.");
                    resolve({ success: true });
                }, 1000);
            });
        }
    </script>
</body>
</html>
